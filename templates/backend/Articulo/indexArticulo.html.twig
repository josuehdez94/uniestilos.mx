{% extends 'backend/Default/homePage.html.twig' %}
{% block title %}Articulos{% endblock %}
{% set menu = 'Articulos' %}
{% set list = 'Articulos' %}
{% block buscador %}
    <form action="{{ url('backend_articulo_index') }}" id="SearchArticulo">
        <input type="text" name="busqueda" placeholder="Buscar articulo" id="busqueda" required>
        <i class="ti-search"></i>
    </form>
    <script>
        $('#SearchArticulo').submit(function(e){
            e.preventDefault();
            $.ajax({
                type: "GET",
                url: $(this).attr('action'),
                data: {
                    'busqueda': $('#busqueda').val(),
                },
                cache: false,
                beforeSend: function () {
                    showFlotante('Buscando...');
                },
                success: function (s) {
                    rs = JSON.parse(s);
                    if (rs.type == 'success') {
                        $('.contenido').html(rs.content);
                    }
                    hideFlotante();
                },
                error: function(s){

                }
            });
        });
    </script>
{% endblock %}
{% block content %}
<div class="contenido mt-2">
    <div class="page-title-area">
        <div class="row align-items-center">
            <div class="col-sm-6">
                <div class="breadcrumbs-area clearfix">
                    <ul class="breadcrumbs pull-left">
                        <li><a href="{{ url('backend_articulo_index') }}">Articulos</a></li>
                        <li><span>Lista articulos</span></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="row mt-5">
        <div class="col-lg-8 col-md-8 col-sm-12">
            <div class="pages">
                {{ knp_pagination_render(articulos, null, {}, {'size': 'small','rounded': true}) }}
            </div>
        </div>
        <div class="col-lg-4 col-md-4 col-sm-12 text-right">
            <span class="text-secondary">{{ articulos.getTotalItemCount ~ ' articulos' }}</span>
        </div>
    </div>
    <div class="row mt-2">
        <div class="col-12 text-right">
            <div class="invoice-buttons">
                <a class="invoice-btn" href="{{ url('backend_articulo_nuevo') }}">
                    <i class="fa fa-plus"></i>
                </a>
            </div>
        </div>
    </div>
    {% for label, messages in app.flashes(['Editado', 'Eliminado', 'Creado']) %}
        {% for message in messages %}
            <div class="col-md-8">
                <div class="alert {{ label == 'Editado' or label == 'Creado' or 'Eliminado' ? 'alert-success' : 'alert-danger' }} alert-dismissible fade show" role="alert" id="flashMessage">
                    <strong>{{label}}</strong>, {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            </div>
        {% endfor %}
        <script>
            $("#flashMessage").fadeTo(7000, 500).slideUp(500, function () {
                $("#flashMessage").alert('close');
            });
        </script>
    {% endfor %}
    <div class="table-responsive">
        <table class="table table-sm table-hover mt-3">
            <thead class="text-center thead-light">
                <tr>
                    <th>Sku</th>
                    <th>Descripcion</th>
                    <th>Asinar tallas</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody class="text-center">
            {% for articulo in articulos %}
                <tr style="font-size: 1em">
                    <td>{{ articulo.sku }}</td>
                    <td>{{ articulo.descripcion }}</td>
                    <td><a href="{{ url('backend_articulo_talla_asignar', {'articulo_id': articulo.id }) }}">Tallas</a></td>
                    <td>
                        <ul class="d-flex justify-content-center">
                            <li class="mr-3">
                                <a class="mx-2" href="{{ url('backend_articulo_detalles', {'id': articulo.id}) }}">
                                    <i class="fa fa-eye text-info"></i>
                                </a>
                            </li>
                            <li class="mr-3">
                                <a class="mx-2" href="{{ path('backend_articulo_editar', {'id': articulo.id}) }}">
                                    <i class="fa fa-edit text-primary"></i>
                                </a>
                            </li>
                            <li class="mr-3">
                                <a class="mx-2" href="#eliminarCategoria" data-toggle="modal" data-target="#eliminarCategoria-{{ articulo.id }}">
                                    <i class="ti-trash text-danger"></i>
                                </a>
                            </li>
                        </ul>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="10">No hay articulos</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="pages pagination justify-content-center">
        {{ knp_pagination_render(articulos, null, {}, {'size': 'small','rounded': true}) }}
    </div>
    <script>
        function paginator(url) {
            $.ajax({
                type: "GET",
                url: url,
                beforeSend: function (s) {
                    showFlotante('Cargando...');
                },
                success: function (s) {
                    rs = JSON.parse(s);
                    if (rs.type == 'success') {
                        $('.contenido').html(rs.content);
                    } else {
                        swal({title: "Oops", text: rs.message, timer: 4000, icon: "error", button: false, });
                    }
                    hideFlotante();
                },
                error: function (s) {
                    hideFlotante();
                    swal({title: "Oops", text: 'Error en la peticion', timer: 3000, icon: "error", button: false, });
                }
            });
            return false;
        }
        $('a[class="desc"]').on('click', function (e) {
            e.preventDefault();
            paginator($(this).attr('href'));
        });
        $('a[class="asc"]').on('click', function (e) {
            e.preventDefault();
            paginator($(this).attr('href'));
        });
        $('a[class="sortable"]').on('click', function (e) {
            e.preventDefault();
            paginator($(this).attr('href'));
        });
        $('a[class="page-link"]').on('click', function (e) {
            e.preventDefault();
            paginator($(this).attr('href'));
        });
    </script>
</div>
{% endblock %}
